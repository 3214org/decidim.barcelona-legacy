<% cache [locale_and_user_status, commentable_cache_key(@proposal), @all_visible_comments, @all_visible_comments.map(&:author), @proposal.comments_count, @comment_flags] do %>
  <section class="row-full comments">
    <div class="row">
      <div id="comments" class="small-12 column">

        <h2>
          <%= t("proposals.show.comments_title") %>
          <span class="js-comments-count">(<%= @proposal.comments_count %>)</span>
        </h2>

        <!-- Filter for comments -->
        <div class="filter-comments small-12 medium-8">
          <form>
            <div class="small-12 medium-8 left">
              <label for="order-selector-participation"><%= t("debates.index.select_order") %></label>
            </div>
            <div class="small-12 medium-4 left">
              <select class="js-location-changer js-order-selector select-order" data-order="<%= @current_order %>" name="order-selector" id="order-selector-participation">
                <option>Más votados</option>
                <option>Más nuevos</option>
                <option>Aleatorios</option>
              </select>
            </div>
          </form>
        </div>
        <!-- /. Filter for comments -->

        <% if user_signed_in? %>
          <%= render 'comments/form', {commentable: @proposal, parent_id: nil, toggeable: false} %>
        <% else %>
        <br>

        <div class="alert-box radius info">
          <%= t("proposals.show.login_to_comment",
              signin: link_to(t("votes.signin"), new_user_session_path),
              signup: link_to(t("votes.signup"), new_user_registration_path)).html_safe %>
          </div>
        <% end %>

        <% @root_comments.each do |comment| %>
          <%= render 'comments/comment', comment: comment  %>
        <% end %>
        <%= paginate @root_comments %>
      </div>
    </div>
  </section>
<% end %>